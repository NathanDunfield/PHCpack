# tested with nvcc version 5.5.0 and gcc 4.4.7 on C2050
# Note that the -arch=sm_13 is needed on the C2050.
# tested with nvcc version 10.1 and gcc 4.8.5 on Volta
# On Volta, the -arch=sm_13 is not needed.

gpp=/usr/bin/g++
MPD=../Norms
CUDA=/usr/local/cuda/include
CUDALIB=/usr/local/cuda/lib64

dbl_convolutions_kernels.o:
	@-echo ">>> compiling convolution kernels for doubles ..."
	nvcc -ccbin=$(gpp) -c dbl_convolutions_kernels.cu

dbl2_convolutions_kernels.o:
	@-echo ">>> compiling convolution kernels for double doubles ..."
	nvcc -ccbin=$(gpp) -c -I$(MPD) dbl2_convolutions_kernels.cu

random_numbers.o:
	@-echo ">>> compiling random number generators ..."
	$(gpp) -O3 -c -I$(MPD) $(MPD)/random_numbers.cpp

random2_vectors.o:
	@-echo ">>> compiling double double random vector generators ..."
	$(gpp) -O3 -c -I$(MPD) $(MPD)/random2_vectors.cpp

random3_vectors.o:
	@-echo ">>> compiling triple double random vector generators ..."
	$(gpp) -O3 -c -I$(MPD) $(MPD)/random3_vectors.cpp

random4_vectors.o:
	@-echo ">>> compiling quad double random vector generators ..."
	$(gpp) -O3 -c -I$(MPD) $(MPD)/random4_vectors.cpp

dbl_convolutions_host.o:
	@-echo ">>> compiling dbl_convolutions_host ..."
	$(gpp) -O3 -c dbl_convolutions_host.cpp

double_double_functions.o:
	@-echo ">>> compiling double double functions ..."
	$(gpp) -O3 -c -I$(MPD) $(MPD)/double_double_functions.cpp

triple_double_functions.o:
	@-echo ">>> compiling triple double functions ..."
	$(gpp) -O3 -c -I$(MPD) $(MPD)/triple_double_functions.cpp

quad_double_functions.o:
	@-echo ">>> compiling quad double functions ..."
	$(gpp) -O3 -c -I$(MPD) $(MPD)/quad_double_functions.cpp

dbl2_convolutions_host.o:
	@-echo ">>> compiling dbl2_convolutions_host ..."
	$(gpp) -O3 -c -I$(MPD) dbl2_convolutions_host.cpp

dbl3_convolutions_host.o:
	@-echo ">>> compiling dbl3_convolutions_host ..."
	$(gpp) -O3 -c -I$(MPD) dbl3_convolutions_host.cpp

dbl4_convolutions_host.o:
	@-echo ">>> compiling dbl4_convolutions_host ..."
	$(gpp) -O3 -c -I$(MPD) dbl4_convolutions_host.cpp

test_dbl_convolutions.o:
	@-echo ">>> compiling test_dbl_convolutions ..."
	$(gpp) -O3 -c -I$(CUDA) -I$(MPD) test_dbl_convolutions.cpp

test_dbl2_convolutions.o:
	@-echo ">>> compiling test_dbl2_convolutions ..."
	$(gpp) -O3 -c -I$(CUDA) -I$(MPD) test_dbl2_convolutions.cpp

test_dbl3_convolutions.o:
	@-echo ">>> compiling test_dbl3_convolutions ..."
	$(gpp) -O3 -c -I$(MPD) test_dbl3_convolutions.cpp

test_dbl4_convolutions.o:
	@-echo ">>> compiling test_dbl4_convolutions ..."
	$(gpp) -O3 -c -I$(MPD) test_dbl4_convolutions.cpp

test_dbl_convolutions: dbl_convolutions_kernels.o dbl_convolutions_host.o \
                       random_numbers.o test_dbl_convolutions.o
	@-echo ">>> linking ..."
	$(gpp) -o test_dbl_convolutions test_dbl_convolutions.o \
                  dbl_convolutions_host.o random_numbers.o \
                  dbl_convolutions_kernels.o -lcuda -lcudart -L$(CUDALIB)

test_dbl2_convolutions: double_double_functions.o dbl2_convolutions_host.o \
                        random_numbers.o random2_vectors.o \
                        dbl2_convolutions_kernels.o test_dbl2_convolutions.o
	@-echo ">>> linking ..."
	$(gpp) -o test_dbl2_convolutions test_dbl2_convolutions.o \
                  random_numbers.o random2_vectors.o \
                  double_double_functions.o dbl2_convolutions_host.o \
                  dbl2_convolutions_kernels.o -lcuda -lcudart -L$(CUDALIB)

test_dbl3_convolutions: double_double_functions.o triple_double_functions.o \
                        random_numbers.o random3_vectors.o \
                        dbl3_convolutions_host.o test_dbl3_convolutions.o
	@-echo ">>> linking ..."
	$(gpp) -o test_dbl3_convolutions test_dbl3_convolutions.o \
                  double_double_functions.o triple_double_functions.o \
                  random_numbers.o random3_vectors.o \
                  dbl3_convolutions_host.o

test_dbl4_convolutions: double_double_functions.o quad_double_functions.o \
                        random_numbers.o random4_vectors.o \
                        dbl4_convolutions_host.o test_dbl4_convolutions.o
	@-echo ">>> linking ..."
	$(gpp) -o test_dbl4_convolutions test_dbl4_convolutions.o \
                  double_double_functions.o quad_double_functions.o \
                  random_numbers.o random4_vectors.o \
                  dbl4_convolutions_host.o

clean:
	/bin/rm -f -r random_numbers.o
	/bin/rm -f -r dbl_convolutions_host.o dbl_convolutions_kernels.o
	/bin/rm -f -r test_dbl_convolutions.o test_dbl_convolutions
	/bin/rm -f -r double_double_functions.o
	/bin/rm -f -r random2_vectors.o random3_vectors.o
	/bin/rm -f -r dbl2_convolutions_host.o dbl2_convolutions_kernels.o
	/bin/rm -f -r test_dbl2_convolutions.o test_dbl2_convolutions
	/bin/rm -f -r triple_double_functions.o dbl3_convolutions_host.o
	/bin/rm -f -r test_dbl3_convolutions.o test_dbl3_convolutions
	/bin/rm -f -r random4_vectors.o
	/bin/rm -f -r quad_double_functions.o dbl4_convolutions_host.o
	/bin/rm -f -r test_dbl4_convolutions.o test_dbl4_convolutions
